let
  Source = SharePoint.Files("https://libertymutual.sharepoint.com/sites/GRMFSDataStrategy", [ApiVersion = 15]),
  #"Filtered rows" = Table.SelectRows(Source, each Text.EndsWith([Folder Path], "USRM Versions SC TL/")),
  #"Filtered hidden files" = Table.SelectRows(#"Filtered rows", each [Attributes]?[Hidden]? <> true),
  #"Invoke custom function" = Table.AddColumn(#"Filtered hidden files", "Transform file (8)", each #"Transform file (8)"([Content])),
  #"Renamed columns" = Table.RenameColumns(#"Invoke custom function", {{"Name", "Source.Name"}}),
  #"Removed other columns" = Table.SelectColumns(#"Renamed columns", {"Source.Name", "Transform file (8)"}),
  #"Expanded table column" = Table.ExpandTableColumn(#"Removed other columns", "Transform file (8)", Table.ColumnNames(#"Transform file (8)"(#"Sample file (8)"))),
  #"Changed column type" = Table.TransformColumnTypes(#"Expanded table column", {{"Line Item", type text}, {"Segment", type text}, {"LOB", type text}, {"Channel Hierarchy", type text}, {"RI Code", type text}, {"State", type text}, {"SC Reinsurance Code", type text}, {"Period", type date}, {"Value", type number}}),
  #"Added Version" = Table.AddColumn(#"Changed column type", "Version", each Text.Middle([Source.Name], 40, 4), type text),
  #"Removed Columns2" = Table.RemoveColumns(#"Added Version", {"Source.Name"}),
  #"Replaced Value" = Table.ReplaceValue(#"Removed Columns2"," - Reinsurance","",Replacer.ReplaceText,{"Line Item"}),
  #"Renamed Columns1" = Table.RenameColumns(#"Replaced Value", {{"Channel Hierarchy", "Channel"}, {"LOB", "Line"}, {"Line Item", "Account"}, {"State", "States"}, {"Value", "Amount"}, {"Period", "Book Date"}}),
  #"Added State" = Table.AddColumn(#"Renamed Columns1", "State", each if [#"States"] = "State NA" then "State NA" else if [#"States"] = "" then "State NA" else Text.Start([#"States"],2)),
  #"Added Distribution" = Table.AddColumn(#"Added State", "Distribution", each [#"Segment"] & "-" & [#"Channel"]),
  #"Added Reinsurance" = Table.AddColumn(#"Added Distribution", "Reinsurance", each if [#"RI Code"] = "" & [SC Reinsurance Code] = "" then "" else if [#"RI Code"] = "" then [SC Reinsurance Code] else if [SC Reinsurance Code] = "" then [#"RI Code"] else "NA"),
  #"Removed Columns" = Table.RemoveColumns(#"Added Reinsurance", {"RI Code", "States", "SC Reinsurance Code", "DAC Accounts"}),
  #"Changed Type" = Table.TransformColumnTypes(#"Removed Columns",{{"Book Date", type date}, {"Distribution", type text}, {"Reinsurance", type text}, {"State", type text}, {"Amount", type number}}),
  #"Filtered rows 1" = Table.SelectRows(#"Changed Type", each ([Account] <> "NB Policy Count" and [Account] <> "RB Policy Count"))
in
  #"Filtered rows 1"
