import pandas as pd

# Load the Excel files into pandas DataFrames
forecast = pd.read_excel("path/to/forecast.xlsx", engine='openpyxl')
plan = pd.read_excel("path/to/plan.xlsx", engine='openpyxl')

# Merge the two datasets on the common columns
merged_data = pd.merge(forecast, plan, on=['date', 'lob', 'state', 'reinsurance', 'brand', 'rate_type'], 
                       suffixes=('_forecast', '_plan'), how='left')

# Compare the rates and create a new column to indicate whether they match
merged_data['rate_comparison'] = merged_data.apply(lambda row: 'Match' if row['rate_forecast'] == row['rate_plan'] else 'Mismatch', axis=1)

# View the comparison results
print(merged_data[['date', 'lob', 'state', 'reinsurance', 'brand', 'rate_type', 'rate_forecast', 'rate_plan', 'rate_comparison']])

# Optionally, filter to show only mismatched rows
mismatched_data = merged_data[merged_data['rate_comparison'] == 'Mismatch']
print(mismatched_data[['date', 'lob', 'state', 'reinsurance', 'brand', 'rate_type', 'rate_forecast', 'rate_plan']])
