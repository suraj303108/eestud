import pandas as pd

# Load the CSV file from a SharePoint URL (you may need to authenticate)
url = 'https://libertymutual.sharepoint.com/sites/GRMFSDataStrategy/Shared Documents/General/Final Plan/2024 Combined Plan.csv'
df = pd.read_csv(url)

# Sort the rows by 'Date modified' in descending order (assuming there's a Date column in the file)
df = df.sort_values(by='Date modified', ascending=False)

# Convert 'Book Date' to datetime type
df['Book Date'] = pd.to_datetime(df['Book Date'])

# Change column types as needed
df['Amount'] = pd.to_numeric(df['Amount'], errors='coerce')
df['Account'] = df['Account'].astype(str)
df['Line'] = df['Line'].astype(str)
df['State'] = df['State'].astype(str)
df['Distribution'] = df['Distribution'].astype(str)
df['Reinsurance'] = df['Reinsurance'].astype(str)

# Remove unnecessary columns (columns that are not in the final result)
df = df[['Account', 'Line', 'Book Date', 'Amount', 'State', 'Distribution', 'Reinsurance']]

# Duplicate the 'Distribution' column
df['Distribution - Copy'] = df['Distribution']

# Split the 'Distribution - Copy' column into 'Segment' and 'Channel' based on the delimiter '-'
df[['Segment', 'Channel']] = df['Distribution - Copy'].str.split('-', expand=True)

# Replace 'BME Summary Numerator' and 'BME Summary Denominator' in the 'Account' column
df['Account'] = df['Account'].replace({'BME Summary Numerator': 'BME Numerator', 'BME Summary Denominator': 'BME Denominator'})

# Filter out the rows where 'Distribution' starts with specific strings
exclude_list = ['BL UBER-', 'Custom-', 'Energy-', 'Express-', 'Farm-', 'Inland Marine-', 'Mobility Pod-']
df = df[~df['Distribution'].str.startswith(tuple(exclude_list))]

# Final output
print(df)
